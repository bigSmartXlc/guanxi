<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>关系图</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
    }

    body {
      background: url(https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng3fee0b89c103ccebb797e96c80cdc946951fd2b6d77c85ecc93acd6744a4b735) 100% no-repeat;
      background-size: 100% 100%;
    }

    html {
      font-size: 14px;
    }

    #gxt {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <a href="demo.html">DEMO</a>
  <div id="gxt"></div>
  <script src="js/jquery.min.js"></script>
  <script src="js/echarts.min.js"></script>
  <script>
    var chartDom = document.getElementById('gxt')
    var myChart = echarts.init(chartDom)
    var option
    const datalist = []
    const linelist = []
    var dataJson = [
      {
        id: 'ff738b49-7eb8-4720-b32b-b1a88a894472',
        name: '角色1',
        icon: 'https://knibu-image-temporary.oss-cn-beijing.aliyuncs.com/2022-08-10-d2675cf9-4c41-49aa-a9ee-37c429e8d2ec.png',
        color: '#AA752B',
        isSelect: 0, //是否选中
      },
      {
        id: '3a193595-4a8a-40da-91de-d4acd461b6c8',
        name: '角色2',
        icon: 'https://knibu-image-temporary.oss-cn-beijing.aliyuncs.com/2022-08-10-968ac9d2-1bd3-4d8b-8282-e7c6005b078f.png',
        color: '#AAA819', //角色选中时的背景色
        isSelect: 0, //是否选中
      },
      {
        id: '2fbab760-98de-47d9-ad1e-45ffd8c457d7',
        name: '角色3',
        icon: 'https://knibu-image-temporary.oss-cn-beijing.aliyuncs.com/2022-08-10-53e9245b-4675-4edf-86fc-265108466933.png',
        color: '#74472B', //角色选中时的背景色
        isSelect: 1, //是否选中
      },
    ]

    var lineJson = [
      {
        start: 'ff738b49-7eb8-4720-b32b-b1a88a894472', //对象1的id
        end: '3a193595-4a8a-40da-91de-d4acd461b6c8', //对象2的id
        name0: '哥哥', //靠近对象1的关系名
        name2: '兄弟', //关系的中间名称
        weight0: 1,
        weight1: 1,
      },
      {
        start: '3a193595-4a8a-40da-91de-d4acd461b6c8', //对象1的id
        end: 'ff738b49-7eb8-4720-b32b-b1a88a894472', //对象2的id
        name1: '弟弟', //靠近对象2的关系名
        weight0: 1,
        weight1: 1,
      },
      {
        start: 'ff738b49-7eb8-4720-b32b-b1a88a894472', //对象1的id
        end: '2fbab760-98de-47d9-ad1e-45ffd8c457d7', //对象2的id
        name1: '仇人', //靠近对象2的关系名
        weight0: 1,
        weight1: 1,
      },
      {
        start: '3a193595-4a8a-40da-91de-d4acd461b6c8', //对象1的id
        end: '2fbab760-98de-47d9-ad1e-45ffd8c457d7', //对象2的id
        name2: '情人', //关系中间的名称
        weight0: 1,
        weight1: 1,
      },
    ]
    dataJson.forEach((item) => {
      datalist.push({
        name: item.name,
        draggable: true,
        symbol: `image://${item.icon}`,
        symbolSize: 60,
        symbolKeepAspect: true,
        label: {
          show: true,
          distance: -5,
          position: 'bottom',
          fontSize: 14,
          lineHeight: 24,
          backgroundColor: 'transparent',
          color: '#000',
          padding: [2, 5, 0, 5],
          borderRadius: 4,
        },
        select: {
          itemStyle: {
            shadowBlur: 50,
            shadowColor: item.color,
          },
          label: {
            show: true,
            distance: -5,
            position: 'bottom',
            fontSize: 14,
            lineHeight: 24,
            backgroundColor: item.color,
            color: '#fff',
            padding: [2, 5, 0, 5],
            borderRadius: 40,
          },
        },
      })
    })

    lineJson.forEach((item, index) => {
      dataJson.forEach((n, m) => {
        if (item.start == n.id) {
          item.source = m
        }
        if (item.end == n.id) {
          item.target = m
        }
      })
      item.label = {
        show: true,
        formatter: (params) => {
          return [
            `{a|${item.name0 || ''}}{c|x}{x|${item.name1 || ''}}`,
            `{b|1}{d|${item.name2 || ''}}{y|2}`,
          ].join('\n')
        },
        rich: {
          y: {
            backgroundColor: {
              image: 'img/left.png',
            },
            color: 'transparent',
            verticalAlign: 'top',
            padding: [3.5, 0, 0, 0],
          },
          c: {
            color: 'transparent',
            width: 80,
          },
          d: {
            color: '#000',
            width: 20,
          },
          b: {
            backgroundColor: {
              image: 'img/right.png',
            },
            color: 'transparent',
            verticalAlign: 'top',
            padding: [3.5, 0, 0, 0],
          },
        },
        lineHeight: 4,
      }
    })
    option = {
      title: {
        text: '关系图',
      },
      tooltip: {},
      circular: {
        rotateLabel: false,
      },
      animationDurationUpdate: 1500,
      animationEasingUpdate: 'quinticInOut',
      series: [
        {
          type: 'graph',
          layout: 'force',
          symbolSize: 60,
          selectedMode: 'single',
          focusNodeAdjacency: true,
          roam: true,
          scaleLimit: {
            min: 1.3,
            max: 1.7,
          },
          label: {
            normal: {
              show: true,
              textStyle: {
                fontSize: 14,
              },
            },
          },
          force: {
            repulsion: 5700,
          },
          edgeSymbolSize: [10, 60],
          edgeLabel: {
            normal: {
              show: true,
              textStyle: {
                fontSize: 10,
              },
              formatter: '{c}',
            },
          },
          data: datalist,
          links: lineJson,
          lineStyle: {
            normal: {
              color: '#000',
              opacity: 0.9,
              width: 1,
              curveness: 0,
            },
          },
        },
      ],
    }
    option && myChart.setOption(option)
    myChart.on('click', (arg) => {
      alert('您点击了' + arg.data.name)
    })
  </script>
</body>

</html>