<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>关系图</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
    }

    body {
      background: url(https://lanhu.oss-cn-beijing.aliyuncs.com/SketchPng3fee0b89c103ccebb797e96c80cdc946951fd2b6d77c85ecc93acd6744a4b735) 100% no-repeat;
      background-size: 100% 100%;
    }

    html {
      font-size: 14px;
    }

    #gxt {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <a href="demo.html">DEMO</a>
  <div id="gxt"></div>
  <script src="./data.json"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/echarts.min.js"></script>
  <script type="module" src="./index.js"></script>
  <script>
    let json = data;
    dataJson = json.dataJson
    lineJson = json.lineJson
    var chartDom = document.getElementById('gxt')
    var myChart = echarts.init(chartDom)
    var option
    var datalist = []
    dataJson.forEach((item) => {
      datalist.push({
        name: item.name,
        draggable: true,
        symbol: `image://${item.icon}`,
        symbolSize: 60,
        symbolKeepAspect: true,
        label: {
          show: true,
          distance: -5,
          position: 'bottom',
          fontSize: 14,
          lineHeight: 24,
          backgroundColor: 'transparent',
          color: '#000',
          padding: [2, 5, 0, 5],
          borderRadius: 4,
        },
        select: {
          itemStyle: {
            shadowBlur: 50,
            shadowColor: item.color,
          },
          label: {
            show: true,
            distance: -5,
            position: 'bottom',
            fontSize: 14,
            lineHeight: 24,
            backgroundColor: item.color,
            color: '#fff',
            padding: [2, 5, 0, 5],
            borderRadius: 4,
          },
        },
      })
    })

    lineJson.forEach((item, index) => {
      dataJson.forEach((n, m) => {
        if (item.start == n.id) {
          item.source = m
        }
        if (item.end == n.id) {
          item.target = m
        }
      })
      item.label = {
        show: true,
        formatter: (params) => {
          return [
            `{a|${item.name0 || ""}}{c|x}{x|${item.name1 || ""}}`,
            `${item.name0 ? '{b|1}' : ''}{d|${item.name2 || ''}}${item.name1 ? '{y|2}' : ''}`,
          ].join('\n')
        },
        rich: {
          y: {
            backgroundColor: {
              image: 'img/left.png',
            },
            color: 'transparent',
            verticalAlign: 'top',
            padding: [3.5, 0, 0, 0],
          },
          c: {
            color: 'transparent',
            width: 80,
          },
          d: {
            color: '#000',
            width: 40,
            align: 'center',
          },
          b: {
            backgroundColor: {
              image: 'img/right.png',
            },
            color: 'transparent',
            verticalAlign: 'top',
            padding: [3.5, 0, 0, 0],
          },
        },
        lineHeight: 4,
      }
    })
    option = {
      title: {
        text: '关系图',
      },
      tooltip: {},
      circular: {
        rotateLabel: false,
      },
      animationDurationUpdate: 1500,
      animationEasingUpdate: 'quinticInOut',
      series: [
        {
          type: 'graph',
          layout: 'force',
          symbolSize: 60,
          selectedMode: 'single',
          focusNodeAdjacency: true,
          roam: true,
          scaleLimit: {
            min: 1.3,
            max: 1.7,
          },
          label: {
            normal: {
              show: true,
              textStyle: {
                fontSize: 14,
              },
            },
          },
          force: {
            repulsion: 5700,
          },
          edgeSymbolSize: [10, 60],
          edgeLabel: {
            normal: {
              show: true,
              textStyle: {
                fontSize: 10,
              },
              formatter: '{c}',
            },
          },
          data: datalist,
          links: lineJson,
          lineStyle: {
            normal: {
              color: '#000',
              opacity: 0.9,
              width: 1,
              curveness: 0,
            },
          },
        },
      ],
    }
    option && myChart.setOption(option)
    myChart.on('click', (arg) => {
      alert('您点击了' + arg.data.name)
    })
  </script>
</body>

</html>